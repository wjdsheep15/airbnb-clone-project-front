__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasPermission=p,e.requestPermission=async function(){if(!(0,o.supportsPushNotifications)())return!1;if('denied'===Notification.permission)return!1;if('granted'===Notification.permission)return!0;f((()=>'Attempting to request permissions'));const n=await Notification.requestPermission(),{datadogTags:u}=await(0,s.getInitializeOptions)();switch(f((()=>`Resulting permission: ${n}`)),n){case'granted':(0,t.airdogCount)('service_worker.push_notifications.permission_granted',1,u);break;case'denied':(0,t.airdogCount)('service_worker.push_notifications.permission_denied',1,u);break;case'default':(0,t.airdogCount)('service_worker.push_notifications.permission_default',1,u)}return'granted'===n},e.shouldShowPushNotificationsOptIn=async function(){if(await c())return!1;if('undefined'==typeof Notification)return f((()=>'Not showing push notifications since they\u2019re not supported')),!1;if('denied'===Notification.permission)return f((()=>'Not showing push notifications due to not having permission')),!1;return!0};var t=r(d[0]),n=r(d[1]),o=r(d[2]),s=r(d[3]),u=r(d[4]);const f=(0,n.createLogger)('Push:Permissions',(0,n.createPrefixStyle)('#b95f6f','#fff'));async function c(){return!!p()&&(0,u.hasValidDeviceId)()}function p(){return'undefined'!=typeof Notification&&'granted'===Notification.permission}}),"0a0e02",["3e4681","102445","f09318","436356","e62feb"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeDatadogTags=function(o){let s='unknown';(0,n.isAndroid)()?s='android':(0,n.isIos)()&&(s='ios');const t=`os:${s}`,u=`browser:${(0,n.getUserAgentName)()}`;return[t,u,o].join(',')};var n=r(d[0])}),"159ba6",["e9b7bf"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return(0,u.default)(n())};var u=t(r(d[1]));function n(){const t='_csrf_token';document.querySelector('html');return t}}),"40eeb7",["ba7a76","e7272f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({datadogTags:t,niobeClient:o}){'undefined'!=typeof Notification&&'denied'===Notification.permission&&(0,n.airdogCount)('service_worker.push_permission_denied',1,t);if(v=t,h=o,_(),!(0,l.hasPermission)())return;try{if(!s.default.isLoggedIn())return void(0,f.clearSubscription)();(0,f.updateSubscriptionIfOptedIn)()}catch(t){(0,c.reportError)(t)}},e.getInitializeOptions=async function(){if(!navigator||!navigator.serviceWorker)throw new Error('Push notifications requires a service worker to be available.');const t=await navigator.serviceWorker.ready;if(!t||!t.active)throw new Error('No service worker was activated, push notifications are not available.');await Promise.race([w,u.scheduler.wait({delay:3e4})]);const{tracking_context:s}=o.default.get('layout-init'),{controller:c}=s,l='homes-host-loop'===c?'GLOBAL_HOST':'GLOBAL_TRAVEL',f=t.active.scriptURL.split('/'),_=`/${f[f.length-1]}`,y=(0,p.makeDatadogTags)(`registered_path:${_}`),k=v?[v,y].join(','):y;h||(0,n.airdogCount)('service_worker.push_initialize_timeout',1,k);return{datadogTags:k,appType:l,niobeClient:h,pushNotificationsKey:o.default.get('pushNotificationsKey'),serviceWorkerRegistration:t}};var o=t(r(d[1])),n=r(d[2]),s=t(r(d[3])),c=r(d[4]),u=r(d[5]),l=r(d[6]),f=r(d[7]),p=r(d[8]);let v,h,_;const w=new Promise((t=>{_=t}))}),"436356",["ba7a76","0a58da","3e4681","06a99e","f2f40f","a2c93f","0a0e02","627c69","159ba6"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Workbox=void 0,e.messageSW=n;try{self["workbox:window:6.1.1"]&&_()}catch(n){}function n(n,t){return new Promise((function(o){var s=new MessageChannel;s.port1.onmessage=function(n){o(n.data)},n.postMessage(t,[s.port2])}))}function t(n,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function o(n,t){(null==t||t>n.length)&&(t=n.length);for(var o=0,s=new Array(t);o<t;o++)s[o]=n[o];return s}function s(n,t){var s;if("undefined"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(s=(function(n,t){if(n){if("string"==typeof n)return o(n,t);var s=Object.prototype.toString.call(n).slice(8,-1);return"Object"===s&&n.constructor&&(s=n.constructor.name),"Map"===s||"Set"===s?Array.from(n):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?o(n,t):void 0}})(n))||t&&n&&"number"==typeof n.length){s&&(n=s);var c=0;return function(){return c>=n.length?{done:!0}:{done:!1,value:n[c++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(s=n[Symbol.iterator]()).next.bind(s)}try{self["workbox:core:6.1.1"]&&_()}catch(n){}var c=function(){var n=this;this.promise=new Promise((function(t,o){n.resolve=t,n.reject=o}))};function u(n,t){var o=location.href;return new URL(n,o).href===new URL(t,o).href}var v=function(n,t){this.type=n,Object.assign(this,t)};function f(n,t,o){return o?t?t(n):n:(n&&n.then||(n=Promise.resolve(n)),t?n.then(t):n)}function h(){}var l={type:"SKIP_WAITING"};function p(n,t){if(!t)return n&&n.then?n.then(h):Promise.resolve()}var y=(function(o){var s,h;function y(n,t){var s,h;return void 0===t&&(t={}),(s=o.call(this)||this).nn={},s.tn=0,s.rn=new c,s.en=new c,s.on=new c,s.un=0,s.an=new Set,s.cn=function(){var n=s.fn,t=n.installing;s.tn>0||!u(t.scriptURL,s.sn)||performance.now()>s.un+6e4?(s.vn=t,n.removeEventListener("updatefound",s.cn)):(s.hn=t,s.an.add(t),s.rn.resolve(t)),++s.tn,t.addEventListener("statechange",s.ln)},s.ln=function(n){var t=s.fn,o=n.target,c=o.state,u=o===s.vn,f={sw:o,isExternal:u,originalEvent:n};!u&&s.mn&&(f.isUpdate=!0),s.dispatchEvent(new v(c,f)),"installed"===c?s.wn=self.setTimeout((function(){"installed"===c&&t.waiting===o&&s.dispatchEvent(new v("waiting",f))}),200):"activating"===c&&(clearTimeout(s.wn),u||s.en.resolve(o))},s.dn=function(n){var t=s.hn;t===navigator.serviceWorker.controller&&(s.dispatchEvent(new v("controlling",{sw:t,originalEvent:n,isUpdate:s.mn})),s.on.resolve(t))},s.gn=(h=function(n){var t=n.data,o=n.source;return f(s.getSW(),(function(){s.an.has(o)&&s.dispatchEvent(new v("message",{data:t,sw:o,originalEvent:n}))}))},function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return Promise.resolve(h.apply(this,n))}catch(n){return Promise.reject(n)}}),s.sn=n,s.nn=t,navigator.serviceWorker.addEventListener("message",s.gn),s}h=o,(s=y).prototype=Object.create(h.prototype),s.prototype.constructor=s,s.__proto__=h;var w,b,E=y.prototype;return E.register=function(n){var t=(void 0===n?{}:n).immediate,o=void 0!==t&&t;try{var s=this;return(function(n,t){var s=(function(){if(!o&&"complete"!==document.readyState)return p(new Promise((function(n){return window.addEventListener("load",n)})))})();return s&&s.then?s.then(t):t()})(0,(function(){return s.mn=Boolean(navigator.serviceWorker.controller),s.yn=s.pn(),f(s.bn(),(function(n){s.fn=n,s.yn&&(s.hn=s.yn,s.en.resolve(s.yn),s.on.resolve(s.yn),s.yn.addEventListener("statechange",s.ln,{once:!0}));var t=s.fn.waiting;return t&&u(t.scriptURL,s.sn)&&(s.hn=t,Promise.resolve().then((function(){s.dispatchEvent(new v("waiting",{sw:t,wasWaitingBeforeRegister:!0}))})).then((function(){}))),s.hn&&(s.rn.resolve(s.hn),s.an.add(s.hn)),s.fn.addEventListener("updatefound",s.cn),navigator.serviceWorker.addEventListener("controllerchange",s.dn,{once:!0}),s.fn}))}))}catch(n){return Promise.reject(n)}},E.update=function(){try{return this.fn?p(this.fn.update()):void 0}catch(n){return Promise.reject(n)}},E.getSW=function(){return void 0!==this.hn?Promise.resolve(this.hn):this.rn.promise},E.messageSW=function(t){try{return f(this.getSW(),(function(o){return n(o,t)}))}catch(n){return Promise.reject(n)}},E.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,l)},E.pn=function(){var n=navigator.serviceWorker.controller;return n&&u(n.scriptURL,this.sn)?n:void 0},E.bn=function(){try{var n=this;return(function(n,t){try{var o=n()}catch(n){return t(n)}return o&&o.then?o.then(void 0,t):o})((function(){return f(navigator.serviceWorker.register(n.sn,n.nn),(function(t){return n.un=performance.now(),t}))}),(function(n){throw n}))}catch(n){return Promise.reject(n)}},w=y,(b=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&t(w.prototype,b),y})((function(){function n(){this.Pn=new Map}var t=n.prototype;return t.addEventListener=function(n,t){this.Sn(n).add(t)},t.removeEventListener=function(n,t){this.Sn(n).delete(t)},t.dispatchEvent=function(n){n.target=this;for(var t,o=s(this.Sn(n.type));!(t=o()).done;)(0,t.value)(n)},t.Sn=function(n){return this.Pn.has(n)||this.Pn.set(n,new Set),this.Pn.get(n)},n})());e.Workbox=y}),"47df49",[]);
__d((function(g,r,i,a,m,e,d){"use strict";let _;Object.defineProperty(e,"__esModule",{value:!0}),e.AuthTriggerTypes=void 0,e.AuthTriggerTypes=_,(function(_){_.CLAIM_GIFT_CARD="claim_gift_card",_.CONTACT_HOST="contact_host",_.BOOK_IT="book_it",_.BECOME_A_HOST="become_a_host",_.CLAIM_COUPON="claim_coupon",_.WISHLIST="wishlist",_.RESERVATION_ITINERARY="reservation_itinerary",_.REFERRAL="referral",_.PROHOST_LANDING="prohost_landing",_.REPORT_LISTING="report_listing",_.LUXURY_OWNER_ONBOARDING="luxury_owner_onboarding",_.LUXURY_RETREATS_CHECKOUT="luxury_retreats_checkout",_.HOST_REFERRAL="host_referral",_.REPORT_USER_PROFILE="report_user_profile",_.SIGNUP_LOGIN_PAGE="signup_login_page",_.PRO_SIGN_UP="pro_signup_page",_.PROPERTY_MANAGER_LISTING_INVITE="property_manager_listing_invite",_.RECAPTCHA="recaptcha",_.EVENT_SPACES_LANDING="event_spaces_landing",_.A4W_COVID_LANDING="a4w_covid_landing",_.HOST_REFERRAL_LANDING="host_referral_landing",_.CITY_PORTAL_LANDING="city_portal_landing",_.REPORT_REVIEW="report_review",_.BETA_PROGRAM_ENROLLMENT="beta_program_enrollment"})(_||(e.AuthTriggerTypes=_={}))}),"5eb3f8",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,n=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.clearSubscription=P,e.hasValidPushSubscription=async function(){const{serviceWorkerRegistration:t}=await(0,h.getInitializeOptions)();if(!await(0,p.hasValidDeviceId)())return!1;return!!await t.pushManager.getSubscription()},e.optIntoPushNotifications=async function(){const t=await(0,h.getInitializeOptions)();if(!await(0,w.requestPermission)())return _({options:t,metric:'permission_denied'}),!1;_({options:t,metric:'permission_granted'});if(await(0,p.hasValidDeviceId)())return _({description:"Using validated cached device id.",options:t,metric:'device_id_cached'}),await k(),!0;_({description:"Creating a new device id and push subscription.",options:t,metric:'no_device_id_cached'});try{await P()}finally{await k()}return!0},e.updateSubscriptionIfOptedIn=async function(){if(!await(0,p.hasValidDeviceId)())return y((()=>'user has not opted in, attempt to find and clear invalid push subscription')),P();return k()};var s=n(r(d[2])),o=n(r(d[3])),c=r(d[4]),u=r(d[5]),p=t(r(d[6])),l=n(r(d[7])),f=n(r(d[8])),w=r(d[9]),h=r(d[10]),b=r(d[11]);const v='Service Worker:Push Initializer',y=(0,c.createLogger)(v,(0,c.createPrefixStyle)('rebeccapurple','#fff')),_=(0,b.createMarkMilestone)(v,'web_push');async function I(t){const{tracking_context:n={}}=s.default.get('layout-init'),{appType:c}=await(0,h.getInitializeOptions)(),u=o.default.current().id,f=await(0,p.default)(u);if(!u)throw new Error('Cannot make a token without a valid userId.');return{appType:c,appVersion:`${n.controller}:${n.version}`,buildType:'RELEASE',deviceType:(0,l.default)(),deviceVersion:navigator.userAgent,nativeDeviceId:f,timeStamp:String((new Date).getTime()),token:JSON.stringify(t),tokenType:'VAPID',userId:u}}async function k(){if(!await(0,w.hasPermission)())return;const t=await(0,h.getInitializeOptions)(),{pushNotificationsKey:n,serviceWorkerRegistration:s}=t;try{let o=await s.pushManager.getSubscription();o||(o=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}));const c=await I(o),u=await(0,f.default)(c);return _({description:`Push notifications successfully initialized with key: "${n}".`,options:t,metric:'push_subscribe_success',metricPrefix:'service_worker'}),u}catch(n){_({options:t,metric:'push_subscribe_unknown_failure',metricPrefix:'service_worker'}),(0,u.reportError)(n,{fingerprint:n?.message?['PushUnknownFailure']:void 0,originalError:n}),await P()}}async function P(){const t=await(0,h.getInitializeOptions)(),{serviceWorkerRegistration:n}=t,s=await n.pushManager.getSubscription();if(!s)return!0;try{await s.unsubscribe()}catch(n){(0,u.reportError)(n,{originalError:n}),_({options:t,metric:'unsubscribe_failure'})}return y((()=>'Push subscription has been unsubscribed.')),!0}}),"627c69",["45f788","ba7a76","0a58da","06a99e","102445","f2f40f","e62feb","d93056","96c3e8","0a0e02","436356","fae72a"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{niobeClient:n}=await(0,s.getInitializeOptions)(),{errors:l,data:c}=await n.mutate({mutation:u.default,variables:{request:t}});if(l&&l.length>0){const n='Failed to send push token due to network error';f((()=>[n,l]));const s={extra:{...l[0],...t},fingerprint:['PushTokenUpdateFailure']},u=new Error(l[0]?.message??n);throw(0,o.reportError)(u,s),u}return f((()=>['Sent push token to upstream server',c])),c?.pleiades?.writeToken?.deviceId};var n=r(d[1]),o=r(d[2]),s=r(d[3]),u=t(r(d[4]));const f=(0,n.createLogger)('Push:Send Token',(0,n.createPrefixStyle)('#b95f6f','#fff'))}),"96c3e8",["ba7a76","102445","f2f40f","436356","dbdcfd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.logSessionEnd=function(n){return t.default.logUniversalSessionEndEvent(n)},e.logSessionStart=function(n){return t.default.logUniversalSessionStartEvent(n)};var t=n(r(d[1]))}),"9e7031",["ba7a76","c8b97a"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{default:u}=await n.scheduler.postTask(s);return u(t)};var u=t(r(d[1])),n=r(d[2]);const s=()=>r(d[4])(d[3]).then(u.default)}),"a2fd9f",["ba7a76","45f788","a2c93f","436356","c592d7"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={StrengthIndicatorStatuses:!0,IsValidIndicatorStatuses:!0,TOSGroups:!0,Modals:!0,AuthMethods:!0,Boxes:!0,LoginMethods:!0,LoginMethodNames:!0,LoginMethodToName:!0,LoginMethodsForLogging:!0,SignupMethods:!0,SignupMethodsForLogging:!0,SignupPaneViews:!0,SignupPaneViewsForLogging:!0,SignupFormSteps:!0,MowebEmailViews:!0,FormNamesForIDs:!0,LoginMethodToFormNameForIDs:!0,ModalTypes:!0,Panes:!0,Platforms:!0,AuthModalLifecycleStages:!0,AuthBoxLifecycleStages:!0,Providers:!0,NonPopupProviders:!0,ContextualLoginMethods:!0,SuggestedLoginMethods:!0,SuggestedLoginMethodLabels:!0,SuggestedLoginViews:!0,SocialAuthMethods:!0,SocialAuthSource:!0,LoginPaneViews:!0,CombineAuthPaneViews:!0,CombineAuthPaneViewToMethods:!0,LocalStorageKeys:!0,BirthdateValidationStates:!0,PhoneSignupErrorStatuses:!0,SwitchModalSource:!0,AuthPagePaths:!0,DEFAULT_DELAY_SECONDS:!0};e.TOSGroups=e.SwitchModalSource=e.SuggestedLoginViews=e.SuggestedLoginMethods=e.SuggestedLoginMethodLabels=e.StrengthIndicatorStatuses=e.SocialAuthSource=e.SocialAuthMethods=e.SignupPaneViewsForLogging=e.SignupPaneViews=e.SignupMethodsForLogging=e.SignupMethods=e.SignupFormSteps=e.Providers=e.Platforms=e.PhoneSignupErrorStatuses=e.Panes=e.NonPopupProviders=e.MowebEmailViews=e.Modals=e.ModalTypes=e.LoginPaneViews=e.LoginMethodsForLogging=e.LoginMethods=e.LoginMethodToName=e.LoginMethodToFormNameForIDs=e.LoginMethodNames=e.LocalStorageKeys=e.IsValidIndicatorStatuses=e.FormNamesForIDs=e.DEFAULT_DELAY_SECONDS=e.ContextualLoginMethods=e.CombineAuthPaneViews=e.CombineAuthPaneViewToMethods=e.Boxes=e.BirthdateValidationStates=e.AuthPagePaths=e.AuthModalLifecycleStages=e.AuthMethods=e.AuthBoxLifecycleStages=void 0;var _=r(d[0]);let O,n,t,N,I;Object.keys(_).forEach((function(O){"default"!==O&&"__esModule"!==O&&(Object.prototype.hasOwnProperty.call(o,O)||O in e&&e[O]===_[O]||Object.defineProperty(e,O,{enumerable:!0,get:function(){return _[O]}}))})),e.StrengthIndicatorStatuses=O,(function(o){o.weak="weak",o.good="good",o.strong="strong"})(O||(e.StrengthIndicatorStatuses=O={})),e.IsValidIndicatorStatuses=n,(function(o){o.invalid="invalid",o.valid="valid"})(n||(e.IsValidIndicatorStatuses=n={})),e.TOSGroups=t,(function(o){o.WITH_CHECKBOX="with-checkbox",o.NO_CHECKBOX="no-checkbox",o.WITH_LAST_STEP="with-last-step"})(t||(e.TOSGroups=t={})),e.Modals=N,(function(o){o.LOGIN_MODAL="LOGIN_MODAL",o.SIGNUP_MODAL="SIGNUP_MODAL",o.FORGOT_PASSWORD_MODAL="FORGOT_PASSWORD_MODAL",o.SSO_MODAL="SSO_MODAL",o.LOGOUT_MODAL="LOGOUT_MODAL",o.NO_MODAL="NO_MODAL"})(N||(e.Modals=N={})),e.AuthMethods=I,(function(o){o.PHONE="phone",o.OTP_PHONE="otp_phone",o.EMAIL="email",o.PHONE_OR_EMAIL="phone_or_email"})(I||(e.AuthMethods=I={}));let E,P;e.Boxes={LOGIN_BOX:'LOGIN_BOX',SIGNUP_BOX:'SIGNUP_BOX',COMBINE_AUTH_BOX:'COMBINE_AUTH_BOX',COMBINE_OTP_PHONE_BOX:'COMBINE_OTP_PHONE_BOX',FORGOT_PASSWORD_BOX:'FORGOT_PASSWORD_BOX'},e.LoginMethods=E,(function(o){o.EMAIL_LOGIN="EMAIL_LOGIN",o.OTP_PHONE_LOGIN="OTP_PHONE_LOGIN",o.PHONE_LOGIN="PHONE_LOGIN",o.PHONE_OR_EMAIL_LOGIN="PHONE_OR_EMAIL_LOGIN"})(E||(e.LoginMethods=E={})),e.LoginMethodNames=P,(function(o){o.EMAIL_LOGIN="email_login",o.OTP_PHONE_LOGIN="otp_phone_login",o.PHONE_LOGIN="phone_login",o.PHONE_OR_EMAIL_LOGIN="phone_or_email_login",o.OTP_PHONE_LOGIN_PHONE="otp_phone_login_phone"})(P||(e.LoginMethodNames=P={}));const L={[E.EMAIL_LOGIN]:P.EMAIL_LOGIN,[E.OTP_PHONE_LOGIN]:P.OTP_PHONE_LOGIN,[E.PHONE_LOGIN]:P.PHONE_LOGIN,[E.PHONE_OR_EMAIL_LOGIN]:P.PHONE_OR_EMAIL_LOGIN};let s,S,A,M;e.LoginMethodToName=L,e.LoginMethodsForLogging=s,(function(o){o[o.EMAIL_LOGIN=I.EMAIL]="EMAIL_LOGIN",o[o.OTP_PHONE_LOGIN=I.OTP_PHONE]="OTP_PHONE_LOGIN",o[o.PHONE_LOGIN=I.PHONE]="PHONE_LOGIN",o[o.PHONE_OR_EMAIL_LOGIN=I.PHONE_OR_EMAIL]="PHONE_OR_EMAIL_LOGIN"})(s||(e.LoginMethodsForLogging=s={})),e.SignupMethods=S,(function(o){o.PHONE_SIGNUP="PHONE_SIGNUP",o.EMAIL_SIGNUP="EMAIL_SIGNUP",o.MOWEB_EMAIL_SIGNUP="MOWEB_EMAIL_SIGNUP",o.SOCIAL_SIGNUP="SOCIAL_SIGNUP"})(S||(e.SignupMethods=S={})),e.SignupMethodsForLogging=A,(function(o){o[o.PHONE_SIGNUP=I.PHONE]="PHONE_SIGNUP",o[o.EMAIL_SIGNUP=I.EMAIL]="EMAIL_SIGNUP"})(A||(e.SignupMethodsForLogging=A={})),e.SignupPaneViews=M,(function(o){o.ALL_SIGNUP_OPTIONS="ALL_SIGNUP_OPTIONS",o.EMAIL_SIGNUP="EMAIL_SIGNUP",o.MOWEB_EMAIL_SIGNUP="MOWEB_EMAIL_SIGNUP",o.OTP_PHONE_MORE_OPTIONS="OTP_PHONE_MORE_OPTIONS",o.OTP_PHONE_VERIFY_CODE="OTP_PHONE_VERIFY_CODE",o.PHONE_SIGNUP="PHONE_SIGNUP",o.UNIFIED_SIGNUP="UNIFIED_SIGNUP"})(M||(e.SignupPaneViews=M={}));const u={[M.PHONE_SIGNUP]:'phone',[M.EMAIL_SIGNUP]:'email',[M.MOWEB_EMAIL_SIGNUP]:'moweb_email',[M.ALL_SIGNUP_OPTIONS]:'all_options',[M.UNIFIED_SIGNUP]:'unified',[M.OTP_PHONE_MORE_OPTIONS]:'phone_otp_more_options',[M.OTP_PHONE_VERIFY_CODE]:'phone_otp_verify_code'};let l,T;e.SignupPaneViewsForLogging=u,e.SignupFormSteps=l,(function(o){o.ACCOUNT_INFO="ACCOUNT_INFO",o.PROFILE_INFO="PROFILE_INFO",o.UPDATE_PASSWORD="UPDATE_PASSWORD"})(l||(e.SignupFormSteps=l={})),e.MowebEmailViews=T,(function(o){o.EMAIL_AND_PASSWORD="EMAIL_AND_PASSWORD",o.NAMES_AND_BIRTHDATE="NAMES_AND_BIRTHDATE",o.TOS="TOS",o.TOS_DECLINED="TOS_DECLINED"})(T||(e.MowebEmailViews=T={}));const c={ACCOUNT_LOOKUP:'account-lookup',EMAIL_LOGIN:'email-login',FORGOT_PASSWORD:'forgot-password',OTP_PHONE_LOGIN:'otp-phone-login',PHONE_LOGIN:'phone-login',PHONE_OR_EMAIL_LOGIN:'phone-or-email-login'};e.FormNamesForIDs=c;const h={[E.EMAIL_LOGIN]:c.EMAIL_LOGIN,forgot_password:c.FORGOT_PASSWORD,[E.OTP_PHONE_LOGIN]:c.OTP_PHONE_LOGIN,[E.PHONE_LOGIN]:c.PHONE_LOGIN,[E.PHONE_OR_EMAIL_LOGIN]:c.PHONE_OR_EMAIL_LOGIN};let G,p,H,D,U,R;e.LoginMethodToFormNameForIDs=h,e.ModalTypes=G,(function(o){o.MODAL_TYPE_SIGNUP="signup",o.MODAL_TYPE_LOGIN="login"})(G||(e.ModalTypes=G={})),e.Panes=p,(function(o){o.LOGIN="login",o.SIGNUP="signup"})(p||(e.Panes=p={})),e.Platforms=H,(function(o){o.WEB="web",o.MOWEB="moweb"})(H||(e.Platforms=H={})),e.AuthModalLifecycleStages=D,(function(o){o.INITIAL="INITIAL",o.MODAL_OPENED="MODAL_OPENED",o.FLOW_FINISHED="FLOW_FINISHED"})(D||(e.AuthModalLifecycleStages=D={})),e.AuthBoxLifecycleStages=U,(function(o){o.INITIAL="INITIAL",o.AUTH_FINISHED="AUTH_FINISHED",o.FLOW_FINISHED="FLOW_FINISHED"})(U||(e.AuthBoxLifecycleStages=U={})),e.Providers=R,(function(o){o.FACEBOOK="Facebook",o.GOOGLE="Google",o.WECHAT="WeChat",o.ALIPAY="Alipay",o.WEIBO="Weibo",o.APPLE="Apple",o.NAVER="Naver"})(R||(e.Providers=R={}));const F=[R.WECHAT,R.ALIPAY,R.WEIBO];let f,C;e.NonPopupProviders=F,e.ContextualLoginMethods=f,(function(o){o.facebook="facebook",o.google="google",o.email="email",o.onelogin="onelogin",o.phone="phone",o.weibo="weibo",o.alipay="alipay",o.wechat="wechat"})(f||(e.ContextualLoginMethods=f={})),e.SuggestedLoginMethods=C,(function(o){o.email="email",o.facebook="facebook",o.google="google",o.apple="apple",o.naver="naver",o.otp_phone="otp_phone",o.onelogin="onelogin",o.undecided="undecided"})(C||(e.SuggestedLoginMethods=C={}));const w={[C.email]:'Email',[C.facebook]:'Facebook',[C.google]:'Google',[C.apple]:'Apple',[C.naver]:'Naver',[C.otp_phone]:'Phone',[C.onelogin]:'OneLogin',[C.undecided]:'Undecided'};let B,V,b,y,W;e.SuggestedLoginMethodLabels=w,e.SuggestedLoginViews=B,(function(o){o.single="single",o.multiple="multiple"})(B||(e.SuggestedLoginViews=B={})),e.SocialAuthMethods=V,(function(o){o.ALIPAY="alipay",o.FACEBOOK="facebook",o.FACEBOOK_PROMPT="facebook_prompt",o.GOOGLE="google",o.ONELOGIN="onelogin",o.WECHAT="wechat",o.WEIBO="weibo",o.APPLE="apple",o.HUAWEI="huawei",o.NAVER="naver"})(V||(e.SocialAuthMethods=V={})),e.SocialAuthSource=b,(function(o){o.LOGIN_PROMPT="login_prompt",o.SUGGESTED_LOGIN="suggested_login",o.FACEBOOK_PROMPT="facebook_prompt",o.LOGIN="login",o.SIGNUP="signup"})(b||(e.SocialAuthSource=b={})),e.LoginPaneViews=y,(function(o){o.DEFAULT="default",o.SUGGESTED_LOGIN="suggested_login",o.EMAIL_UNIFIED="email_unified",o.EMAIL_UNIFIED_PASSWORD="email_unified_password",o.EMAIL_UNIFIED_SIGNUP="email_unified_signup",o.OTP_PHONE_VERIFY_CODE="otp_phone_verify_code",o.OTP_PHONE_MORE_OPTIONS="otp_phone_more_options",o.OTP_EMAIL_VERIFICATION="otp_email_verification",o.OTP_LOG_IN_ANOTHER_WAY="otp_log_in_another_way"})(y||(e.LoginPaneViews=y={})),e.CombineAuthPaneViews=W,(function(o){o.ALL_LOGIN_OPTIONS="ALL_LOGIN_OPTIONS",o.OTP_PHONE_LOGIN="OTP_PHONE_LOGIN",o.OTP_PHONE_VERIFY_CODE="OTP_PHONE_VERIFY_CODE",o.OTP_PHONE_MORE_OPTIONS="OTP_PHONE_MORE_OPTIONS",o.PHONE_OR_EMAIL_LOGIN="PHONE_OR_EMAIL_LOGIN",o.OTP_PHONE_SIGNUP="OTP_PHONE_SIGNUP",o.EMAIL_SIGNUP="EMAIL_SIGNUP"})(W||(e.CombineAuthPaneViews=W={}));const Y={[W.ALL_LOGIN_OPTIONS]:E.OTP_PHONE_LOGIN,[W.OTP_PHONE_LOGIN]:E.OTP_PHONE_LOGIN,[W.OTP_PHONE_VERIFY_CODE]:E.OTP_PHONE_LOGIN,[W.PHONE_OR_EMAIL_LOGIN]:E.PHONE_OR_EMAIL_LOGIN};e.CombineAuthPaneViewToMethods=Y;let v;e.LocalStorageKeys={LOGOUT_ANYWAY_COUNT_V3:'logout_anyway_count_v3',LOGIN_PROMPT_DISMISSED:'login_prompt_dismissed',FACEBOOK_PROMPT_DISMISSED:'facebook_prompt_dismissed',FACEBOOK_PROMPT_DISMISSED_P3:'facebook_prompt_dismissed_p3',FACEBOOK_PROMPT_SHOW_COUNT:'facebook_prompt_show_count'},e.BirthdateValidationStates=v,(function(o){o.INVALID="INVALID",o.UNDER_THIRTEEN="UNDER_THIRTEEN",o.UNDER_EIGHTEEN="UNDER_EIGHTEEN",o.OVER_EIGHTEEN="OVER_EIGHTEEN"})(v||(e.BirthdateValidationStates=v={}));let k;e.PhoneSignupErrorStatuses={PHONE_ALREADY_USED_BY_PHONE_ACCOUNT:'phone_already_used_by_phone_account',PHONE_ALREADY_USED_BY_EMAIL_ACCOUNT:'phone_already_used_by_email_account',PHONE_ALREADY_USED_BY_SOCIAL_ACCOUNT:'phone_already_used_by_social_account',PHONE_ALREADY_USED_BY_EMAIL_OR_SOCIAL_ACCOUNT:'phone_already_used_by_email_or_social_account'},e.SwitchModalSource=k,(function(o){o.ERROR_MESSAGE="error_message",o.SWITCH_CTA="switch_cta"})(k||(e.SwitchModalSource=k={}));e.AuthPagePaths={ACCOUNT_LINKING:'/account_linking',AUTHENTICATE:'/authenticate'};e.DEFAULT_DELAY_SECONDS=60}),"b616d2",["6126d0"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const{userAgent:t}=navigator;if((0,n.isAndroid)(t))return'ANDROID_VAPID';if((0,n.isIphone)(t))return'IPHONE_VAPID';if((0,n.isIpad)(t))return'IPAD_VAPID';return'DESKTOP_VAPID'};var n=r(d[0])}),"d93056",["e9b7bf"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=t(r(d[1]));var n={document:void 0,getDocument:()=>r(d[3])(d[2]).then(u.default).then((t=>t.default)),name:'SendPushTokenMutation',type:'mutation',operationId:'35f85d8e0ca316c774486242fa697b3b3dd26597467c7744cd45fc6d25282d1c'};e.default=n}),"dbdcfd",["ba7a76","45f788","27c779","c592d7"]);
__d((function(g,r,i,a,m,e,d){"use strict";function t(){const n=r(d[0]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={RookeryMessagePackageEvent:t().RookeryMessagePackageEvent};e.default=n}),"e1839b",["ef628b"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function n(){const t=r(d[1]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const c=t||l();if(!c){const t='Cannot create device id with no user id';throw s((()=>t)),new Error(t)}const o=await _(),I=o?.deviceId;if(I&&p(c,o))return s((()=>`Using "${I}" as stored device push id`)),I;const w=(0,n().v4)();return(0,u.storeInCache)(v,f,h({deviceId:w,userId:c})),w},e.hasValidDeviceId=async function(){const t=l();if(!t)return!1;const n=await _();return p(t,n)};var c=t(r(d[2])),u=r(d[3]),o=r(d[4]);const s=(0,o.createLogger)('Push:Device Id',(0,o.createPrefixStyle)('#b95f6f','#fff')),f='push_token_id',v='airbnb_push_notifications',I=':';function h({deviceId:t,userId:n}){return`${n}${I}${t}`}function l(){return c.default.current().id}function _(){return(0,u.getFromCache)(v,f).then((t=>{if(!t)return;const[n,c]=t.split(I);return{userId:+n,deviceId:c}}))}function p(t,n){return!(!n?.deviceId||n?.userId!==t)}}),"e62feb",["ba7a76","305dd5","06a99e","fe8083","102445"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RookeryMessagePackageEvent=void 0;var o={defaultProps:{schema:'com.airbnb.jitney.event.logging.Rookery:RookeryMessagePackageEvent:1.0.0',event_name:'rookery_message_package'},propTypes:{}};e.RookeryMessagePackageEvent=o,o.fullyQualifiedName='Rookery.v1.RookeryMessagePackageEvent'}),"ef628b",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.createMarkMilestone=function(t,s="service_worker"){const u=(0,c.createLogger)(t,(0,c.createPrefixStyle)('rebeccapurple','#fff'));return function({count:t=1,options:c,metric:f,metricPrefix:l,description:_,tags:p}){const{datadogTags:v}=c,$=[v,p].filter(Boolean).join(','),j=l??s;(0,o.airdogCount)(`${j}.milestone`,t,[`metric:${f}`,$].join(',')),n.default.getBootstrap('send_legacy_worker_metrics')&&(0,o.airdogCount)(`${j}.${f}`,t,$),_&&u((()=>[_,{datadogTags:$,metric:f}]))}};var o=r(d[1]),c=r(d[2]),n=t(r(d[3]))}),"fae72a",["ba7a76","3e4681","102445","c235f8"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.getServiceWorkerPath=L;var n=r(d[1]),o=t(r(d[2])),s=r(d[3]),c=t(r(d[4])),l=r(d[5]),p=r(d[6]),_=r(d[7]),f=r(d[8]),v=t(r(d[9])),h=t(r(d[10])),u=r(d[11]),w=r(d[12]),y=r(d[13]),k=r(d[14]),b=r(d[15]),E=t(r(d[16])),S=r(d[17]);const T=(0,l.createLogger)('ServiceWorker:Installer',(0,l.createPrefixStyle)('rebeccapurple','#fff')),A=(0,u.createMarkMilestone)('ServiceWorker:Installer');function C(t,n,o){const s=new URLSearchParams;Object.keys(n).forEach((t=>{const o=n[t];null!=o&&!1!==o&&s.append(t,String(o))})),o&&Object.keys(o).forEach((t=>{const n=o[t];null!=n&&s.append(t,String(n))}));const c=String(s);return c.length?`${t}?${c}`:t}function L(t,n={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,deliverTripsOfflineExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{deliverAppShellExperiment:o,deliverPWAExperiment:s,deliverPreCachingExperiment:l,deliverTripsOfflineExperiment:p,disableAppShell:_,dynamicPrecaching:f}=n,{force_disable_3p_js:h,force_env:u,force_staging:w,offline:y,sw_workbox_dev_logs:k,utm_source:E,enableReactProfiler:S}=(0,v.default)();return C(t,{dynamic_precaching:f,deliver_app_shell_experiment:o,deliver_pre_caching_experiment:l,deliver_trips_offline_experiment:p,disable_app_shell:_,force_disable_3p_js:h,force_env:u,force_staging:w,enableReactProfiler:S,offline:y,sw_workbox_dev_logs:k,sw_disable_niobe_cache:(0,b.getTreatmentOverride)('sw_disable_niobe_cache')??c.default.getBootstrap('sw_disable_niobe_cache'),sw_pwa_disable_niobe_cache:(0,b.getTreatmentOverride)('sw_pwa_disable_niobe_cache')??c.default.getBootstrap('sw_pwa_disable_niobe_cache'),sw_allow_shell_on_search_verticals:(0,b.getTreatmentOverride)('sw_allow_shell_on_search_verticals')??c.default.getBootstrap('sw_allow_shell_on_search_verticals'),utm_source:E},{sw_enable_offline:s})}function W(t,n){const{pushNotifications:o}=n;(0,p.addLoginCompleteCallback)((async()=>{await t.messageSW({type:'CLEAR_SHELL_CACHE'}),A({metric:'login_and_clear_cache',description:'Any caches storing an app shell have been cleared after login.',options:n}),o&&(0,w.updateSubscriptionIfOptedIn)()})),(0,p.addLogoutCallback)((async()=>{await t.messageSW({type:'CLEAR_SHELL_CACHE'}),A({metric:'logout_and_clear_cache',description:'Any caches storing an app shell have been cleared after logout.',options:n}),(0,w.clearSubscription)()}))}const O='skipping start of the service worker due to user opted out, remove your user from "temporarily_disable_service_workers_for_me" to opt back in.',R='service workers are globally disabled, skipping start';async function I(t,s={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverTripsOfflineExperiment:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{appType:c,datadogTags:l,niobeClient:p,pushNotifications:v}=s,u=L(t,s),k=new n.Workbox(u,{updateViaCache:'all'}),b=`Initializing service worker at path: "${t}", see https://air.bb/service-workers for debugging guides.`;T((()=>[b,{pathWithParams:u}])),W(k,s),(0,_.addUpdateCurrencyCallback)((async()=>{await k.messageSW({type:'CLEAR_SHELL_CACHE'}),A({metric:'update_currency_and_clear_cache',description:'Any caches storing an app shell have been cleared after updating currency.',options:s}),v&&(0,w.updateSubscriptionIfOptedIn)()})),k.addEventListener('installed',(async t=>{A({options:s,metric:'installation',description:'Install event is fired'}),t.isUpdate?A({metric:'version_updated',description:'An installed service worker was updated to a new version.',options:s}):A({metric:'first_installation',description:'A new service worker has installed (for the first time)',options:s}),(s.dynamicPrecaching||s.deliverTripsOfflineExperiment)&&await k.messageSW({type:'PRECACHE_ASSETS',payload:{appVersion:"Unknown"}})})),k.addEventListener('controlling',(async()=>{await k.messageSW({type:'FLUSH_MESSAGES'}),A({options:s,metric:'controlling',description:'The service worker is controlling the page, all behavior such as app shells, fetch handlers and push handlers are now ready.'})})),k.addEventListener('message',(t=>{switch(t.data.type){case'AIRDOG_BUMP':if('string'==typeof t.data.event)A({options:s,metric:`message.${t.data.event}`});else{const{name:n,count:o,tags:c}=t.data.event;A({count:o,options:s,metric:`message.${n}`,tags:c})}break;case'LOG_JITNEY_EVENT':o.default.logJitneyEvent({event_data:t.data.eventData,schema:E.default[t.data.schemaName]});break;case'SW_ERROR':A({description:'An error occurred in the service worker.',options:s,metric:'worker_error'}),(0,f.reportError)(t.data.error,{tags:{service_worker_error_type:'service_worker.worker_error'}});break;case'NOTIFICATION_CLICKED':A({description:'A push notification was clicked.',options:s,metric:'push_notification_clicked'}),(0,y.dispatchNotification)(t.data.payload)}})),k.addEventListener('activated',(async t=>{if(!t.isUpdate&&v){const t=await navigator.serviceWorker.getRegistration();t&&p&&(T((()=>'Initializing push notifications.')),await(0,h.default)({serviceWorkerRegistration:t,datadogTags:l,appType:c,niobeClient:p}))}A({description:'The service worker has finished activating.',options:s,metric:'activated_new_version'})})),k.addEventListener('waiting',(async()=>{if(await k.messageSW({type:'SKIP_WAITING'}))T((()=>'Manual reload signal in development received, reloading page')),location.reload(!0);else{const t='Automatic service worker activation failed, you may need to hard refresh the page to get the new worker.';T((()=>t))}A({options:s,metric:'waiting_to_install'})}));try{const t=await k.register();t&&v&&t.active&&p&&(T((()=>'Initializing push notifications.')),(0,h.default)({serviceWorkerRegistration:t,appType:c,datadogTags:l,niobeClient:p})),A({options:s,metric:'registration'})}catch(t){'SecurityError'!==t?.name?A({description:'The service worker failed to install.',options:s,metric:'failed_installation'}):T((()=>['The service worker failed to install due to a SecurityError',t]))}}async function P(t){try{if((await navigator.serviceWorker.getRegistrations()).length){T((()=>'No service worker was registered but one is active, removing and if in development, reloading the page.'));try{(0,S.unregisterServiceWorker)({legacyOnly:!1})}finally{}}}catch(n){'SecurityError'!==n?.name&&A({description:'The service worker failed to uninstall.',options:t,metric:'failed_uninstallation'})}}function x(t){return c.default.getBootstrap('disable_all_service_workers')||t}var N=async(t,n={})=>{if('undefined'==typeof navigator||!navigator.serviceWorker)return;const o=`registered_path:${t}`,l=(0,k.makeDatadogTags)(o),p={...n,datadogTags:[l,n.datadogTags].filter(Boolean).join(',')};if(!t)return void await P(p);A({options:p,metric:'initialization_attempt'});const{forceResetServiceWorker:_}=(0,v.default)();if(_)return await(0,S.unregisterServiceWorker)({legacyOnly:!1}),void(window.location.search=window.location.search.replace('forceResetServiceWorker','swResetComplete'));const f=c.default.getBootstrap('temporarily_disable_service_workers_for_me'),h=x(f),u=await L(t,p);try{await(0,S.unregisterServiceWorker)({legacyOnly:!h,serviceWorkerPath:u,datadogTags:l})}catch(n){h?T((()=>f?O:R)):(await I(t,p),(0,s.airdogCount)('service_worker.initialization_failed',1,l))}h?T((()=>f?O:R)):await I(t,p)};e.default=N}),"feb86f",["ba7a76","47df49","c8b97a","3e4681","c235f8","102445","9f7af8","737fda","f2f40f","a7c4ef","a2fd9f","fae72a","627c69","2d8379","159ba6","f9341a","e1839b","178ec4"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/service-workers/initialize.2990c24a2c.js.map